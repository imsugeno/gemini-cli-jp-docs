# トラブルシューティングガイド

このガイドでは、一般的な問題の解決策とデバッグのヒントを提供します。

## よくある質問 (FAQ)

- **Q: Gemini CLI を最新バージョンに更新するにはどうすればよいですか？**

  - A: npm でグローバルにインストールした場合は、`npm install -g @google/gemini-cli@latest` コマンドを使用して Gemini CLI を更新します。ソースから実行している場合は、リポジトリから最新の変更を取得し、`npm run build` を使用して再ビルドします。

- **Q: Gemini CLI の設定ファイルはどこに保存されていますか？**

  - A: CLI の設定は、ホームディレクトリとプロジェクトのルートディレクトリにある 2 つの `settings.json` ファイルに保存されます。どちらの場所でも、`settings.json` は `.gemini/` フォルダ内にあります。詳細については、[CLI 設定](./cli/configuration.md) を参照してください。

- **Q: 統計情報出力にキャッシュされたトークン数が表示されないのはなぜですか？**

  - A: キャッシュされたトークン情報は、キャッシュされたトークンが使用されている場合にのみ表示されます。この機能は、API キーユーザー (Gemini API キーまたは Vertex AI) は利用できますが、現時点では Code Assist API がキャッシュされたコンテンツの作成をサポートしていないため、OAuth ユーザー (Google 個人/エンタープライズアカウント) は利用できません。`/stats` コマンドで合計トークン使用量を確認することはできます。

## 一般的なエラーメッセージと解決策

- **エラー: MCP サーバー起動時の `EADDRINUSE` (アドレスは既に使用されています)。**

  - **原因:** MCP サーバーがバインドしようとしているポートを別のプロセスが既に使用しています。
  - **解決策:**
    ポートを使用している他のプロセスを停止するか、MCP サーバーが別のポートを使用するように設定します。

- **エラー: コマンドが見つかりません (Gemini CLI を実行しようとしたとき)。**

  - **原因:** Gemini CLI が正しくインストールされていないか、システムの PATH に含まれていません。
  - **解決策:**
    1. Gemini CLI のインストールが成功したことを確認します。
    2. グローバルにインストールした場合は、npm のグローバルバイナリディレクトリが PATH に含まれていることを確認します。
    3. ソースから実行している場合は、正しいコマンド (`node packages/cli/dist/index.js ...` など) を使用して呼び出していることを確認します。

- **エラー: `MODULE_NOT_FOUND` またはインポートエラー。**

  - **原因:** 依存関係が正しくインストールされていないか、プロジェクトがビルドされていません。
  - **解決策:**
    1. `npm install` を実行して、すべての依存関係が存在することを確認します。
    2. `npm run build` を実行して、プロジェクトをコンパイルします。

- **エラー: 「操作は許可されていません」、「権限がありません」など。**

  - **原因:** サンドボックスが有効になっている場合、アプリケーションは、プロジェクトディレクトリまたはシステムの `temp` ディレクトリ以外への書き込みなど、サンドボックスによって制限されている操作を試みている可能性があります。
  - **解決策:** サンドボックス設定のカスタマイズ方法など、詳細については [サンドボックス](./cli/configuration.md#sandboxing) を参照してください。

## デバッグのヒント

- **CLI のデバッグ:**

  - 詳細な出力を得るには、CLI コマンドで `--verbose` フラグ (利用可能な場合) を使用します。
  - CLI のログを確認します。通常、ユーザー固有の設定またはキャッシュディレクトリにあります。

- **コアのデバッグ:**

  - サーバーコンソールの出力でエラーメッセージやスタックトレースを確認します。
  - 設定可能であれば、ログの詳細度を上げます。
  - サーバー側のコードをステップ実行する必要がある場合は、Node.js のデバッグツール (`node --inspect` など) を使用します。

- **ツールの問題:**

  - 特定のツールが失敗する場合は、そのツールが実行するコマンドまたは操作の最も単純なバージョンを実行して、問題を切り分けます。
  - `run_shell_command` の場合は、まずシェルでコマンドが直接機能することを確認します。
  - ファイルシステムツールの場合は、パスと権限を再確認します。

- **事前チェック:**
  - コードをコミットする前に、必ず `npm run preflight` を実行してください。これにより、フォーマット、リンティング、型エラーに関連する多くの一般的な問題を検出できます。

ここに記載されていない問題が発生した場合は、GitHub でプロジェクトの課題トラッカーを検索するか、詳細な情報を添えて新しい課題を報告することを検討してください。