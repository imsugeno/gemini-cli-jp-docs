# Gemini CLI アーキテクチャの概要

このドキュメントでは、Gemini CLI のアーキテクチャの概要を説明します。

## コアコンポーネント

Gemini CLI は、主に 2 つの主要なパッケージと、コマンドライン入力を処理する過程でシステムが使用できる一連のツールで構成されています。

1.  **CLI パッケージ (`packages/cli`):**

    - **目的:** これには、最初のユーザー入力の処理、最終的な出力の表示、全体的なユーザーエクスペリエンスの管理など、Gemini CLI のユーザー向けの機能が含まれています。
    - **パッケージに含まれる主な機能:**
      - [入力処理](./cli/commands.md)
      - 履歴管理
      - 表示レンダリング
      - [テーマと UI のカスタマイズ](./cli/themes.md)
      - [CLI 構成設定](./cli/configuration.md)

2.  **コアパッケージ (`packages/core`):**

    - **目的:** これは Gemini CLI のバックエンドとして機能します。`packages/cli` から送信されたリクエストを受信し、Gemini API との対話を調整し、利用可能なツールの実行を管理します。
    - **パッケージに含まれる主な機能:**
      - Google Gemini API と通信するための API クライアント
      - プロンプトの作成と管理
      - ツールの登録と実行ロジック
      - 会話またはセッションの状態管理
      - サーバー側の構成

3.  **ツール (`packages/core/src/tools/`):**
    - **目的:** これらは、Gemini モデルの機能を拡張する個別のモジュールであり、ローカル環境 (ファイルシステム、シェルコマンド、Web フェッチなど) と対話できるようにします。
    - **対話:** `packages/core` は、Gemini モデルからのリクエストに基づいてこれらのツールを呼び出します。

## 対話フロー

Gemini CLI との一般的な対話は、次のフローに従います。

1.  **ユーザー入力:** ユーザーは、`packages/cli` によって管理されるターミナルにプロンプトまたはコマンドを入力します。
2.  **コアへのリクエスト:** `packages/cli` は、ユーザーの入力を `packages/core` に送信します。
3.  **リクエストの処理:** コアパッケージ:
    - 会話履歴や利用可能なツールの定義を含む可能性のある、Gemini API に適したプロンプトを作成します。
    - プロンプトを Gemini API に送信します。
4.  **Gemini API の応答:** Gemini API はプロンプトを処理し、応答を返します。この応答は、直接の回答である場合もあれば、利用可能なツールのいずれかを使用するリクエストである場合もあります。
5.  **ツールの実行 (該当する場合):**
    - Gemini API がツールをリクエストすると、コアパッケージはそれを実行する準備をします。
    - 要求されたツールがファイルシステムを変更したり、シェルコマンドを実行したりできる場合、ユーザーにはまずツールとその引数の詳細が提供され、ユーザーは実行を承認する必要があります。
    - ファイルの読み取りなどの読み取り専用操作では、続行するために明示的なユーザーの確認は必要ない場合があります。
    - 確認されるか、確認が不要な場合、コアパッケージは関連するツール内で関連するアクションを実行し、結果はコアパッケージによって Gemini API に返送されます。
    - Gemini API はツールの結果を処理し、最終的な応答を生成します。
6.  **CLI への応答:** コアパッケージは、最終的な応答を CLI パッケージに返送します。
7.  **ユーザーへの表示:** CLI パッケージは、応答をフォーマットしてターミナルでユーザーに表示します。

## 主な設計原則

- **モジュール性:** CLI (フロントエンド) をコア (バックエンド) から分離することで、独立した開発と将来の拡張 (同じバックエンドに対する異なるフロントエンドなど) が可能になります。
- **拡張性:** ツールシステムは拡張可能に設計されており、新しい機能を追加できます。
- **ユーザーエクスペリエンス:** CLI は、リッチでインタラクティブなターミナルエクスペリエンスの提供に重点を置いています。